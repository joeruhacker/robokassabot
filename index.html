<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Магазин цифровых товаров</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <!-- Подключение Google Fonts (пример: Poppins) -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-color: var(--tg-theme-bg-color, #f2f2f2);
      --text-color: var(--tg-theme-text-color, #333);
      --secondary-bg-color: var(--tg-theme-secondary-bg-color, #fff);
      --button-color: var(--tg-theme-button-color, #007bff);
      --button-text-color: var(--tg-theme-button-text-color, #fff);
      --hint-color: var(--tg-theme-hint-color, #666);

      --transition-speed: 0.4s;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      overflow-x: hidden;
    }

    h1, h2, h3 {
      font-weight: 300;
      text-align: center;
      margin: 10px 0;
    }

    /* Общий контейнер */
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Страницы (экраны) */
    .page {
      width: 100%;
      min-height: 80vh;
      opacity: 1;
      visibility: visible;
      transition: opacity var(--transition-speed) ease, visibility var(--transition-speed) ease;
    }
    .page.hidden {
      opacity: 0;
      visibility: hidden;
      position: absolute;
      top: 0;
      left: 0;
    }

    /* Главный экран с категориями */
    .categories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }

    .category-card {
      background-color: var(--secondary-bg-color);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: transform 0.3s;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .category-card:hover {
      transform: translateY(-5px);
    }
    .category-card img {
      width: 100%;
      height: auto;
      object-fit: cover;
      display: block;
    }
    .category-card h2 {
      margin: 10px 0;
      font-weight: 400;
    }

    /* Экран товаров */
    .products-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      gap: 10px;
    }

    .back-button {
      align-self: flex-start;
      background-color: var(--button-color);
      color: var(--button-text-color);
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      text-decoration: none;
      margin-bottom: 10px;
      transition: background-color 0.2s;
    }
    .back-button:hover {
      background-color: #0056b3;
    }

    .product-item {
      width: 100%;
      max-width: 400px;
      background-color: var(--secondary-bg-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 5px;
      padding: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .product-info {
      display: flex;
      flex-direction: column;
    }
    .product-name {
      font-size: 16px;
      margin-bottom: 4px;
    }
    .product-price {
      font-size: 14px;
      color: var(--hint-color);
    }
    .add-to-cart {
      background-color: var(--button-color);
      color: var(--button-text-color);
      padding: 6px 12px;
      text-align: center;
      border-radius: 20px;
      cursor: pointer;
      text-decoration: none;
      transition: background-color 0.2s;
      font-size: 14px;
    }
    .add-to-cart:hover {
      background-color: #0056b3;
    }

    /* Кнопка "Корзина" на главном экране */
    .cart-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #28a745;
      color: #fff;
      padding: 12px 20px;
      border-radius: 30px;
      cursor: pointer;
      text-decoration: none;
      transition: background-color 0.2s;
      font-size: 16px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      z-index: 999;
    }
    .cart-button:hover {
      background-color: #218838;
    }

    /* Экран корзины */
    .cart-page .products-container {
      align-items: flex-start;
    }
    .cart-item {
      width: 100%;
      max-width: 500px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: var(--secondary-bg-color);
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .remove-from-cart {
      background-color: #dc3545;
      color: #fff;
      padding: 6px 12px;
      border-radius: 20px;
      cursor: pointer;
      text-decoration: none;
      transition: background-color 0.2s;
      font-size: 14px;
      margin-left: 10px;
    }
    .remove-from-cart:hover {
      background-color: #c82333;
    }

    #checkout {
      background-color: #28a745;
      color: #fff;
      padding: 12px 20px;
      text-align: center;
      border-radius: 30px;
      cursor: pointer;
      text-decoration: none;
      transition: background-color 0.2s;
      margin: 20px auto 0 auto;
      display: none;
      font-size: 16px;
    }
    #checkout:hover {
      background-color: #218838;
    }

    /* Анимация плавного появления / скрытия страниц */
    .fade-enter {
      opacity: 0;
      transform: translateY(10px);
    }
    .fade-enter.fade-enter-active {
      opacity: 1;
      transform: translateY(0);
      transition: opacity var(--transition-speed), transform var(--transition-speed);
    }
    .fade-exit {
      opacity: 1;
      transform: translateY(0);
    }
    .fade-exit.fade-exit-active {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity var(--transition-speed), transform var(--transition-speed);
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Главный экран (категории) -->
    <div id="main-page" class="page">
      <h1>Добро пожаловать в наш магазин!</h1>
      <div class="categories-grid">
        <!-- Робукс -->
        <div class="category-card" data-category="Robux">
          <img src="https://i.pinimg.com/564x/5a/03/19/5a03197c13860729206536d3fb4ca7dc.jpg" alt="Robux">
          <h2>Robux</h2>
        </div>

        <!-- Айтюнс -->
        <div class="category-card" data-category="iTunes">
          <img src="https://i.pinimg.com/564x/53/60/b9/5360b97e71f3204c70275132893d0070.jpg" alt="iTunes">
          <h2>iTunes</h2>
        </div>

        <!-- Фортнайт -->
        <div class="category-card" data-category="Fortnite">
          <img src="https://cdn2.unrealengine.com/Fortnite%2Fblog%2Fpatch-v10-10-bring-on-the-bugs%2F10BR_ArtistPatchNotes_NewsHeader-1920x1080-32f2a3f46f43a50ec915c7d509c1f68b7c6c6b43.jpg" alt="Fortnite">
          <h2>Fortnite</h2>
        </div>

        <!-- Майнкрафт -->
        <div class="category-card" data-category="Minecraft">
          <img src="https://upload.wikimedia.org/wikipedia/ru/2/20/Minecraft_logo.png" alt="Minecraft">
          <h2>Minecraft</h2>
        </div>

        <!-- Варкрафт -->
        <div class="category-card" data-category="Warcraft">
          <img src="https://upload.wikimedia.org/wikipedia/ru/8/85/WarcraftIII_Reforged_Logo.png" alt="Warcraft">
          <h2>Warcraft</h2>
        </div>
      </div>
    </div>

    <!-- Экран с товарами выбранной категории -->
    <div id="products-page" class="page hidden">
      <div class="products-container">
        <button class="back-button" id="back-to-main">Назад</button>
        <h2 id="products-title">Категория</h2>
        <div id="products-list"></div>
      </div>
    </div>

    <!-- Экран корзины -->
    <div id="cart-page" class="page hidden">
      <div class="products-container">
        <button class="back-button" id="back-to-main-from-cart">Назад</button>
        <h2>Корзина</h2>
        <div id="cart-list"></div>
        <div id="checkout">Оплатить</div>
      </div>
    </div>
  </div>

  <!-- Кнопка для отображения корзины (только на главном экране) -->
  <div class="cart-button" id="cart-button" style="display: none;">
    Корзина (<span id="cart-count">0</span>)
  </div>

  <!-- Подключение Telegram WebApp JS -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <script>
    // Инициализация Telegram Web Apps
    const tg = window.Telegram.WebApp;
    tg.expand();

    // Устанавливаем цвета темы приложения
    document.body.style.backgroundColor = tg.themeParams.bg_color || '#ffffff';
    document.body.style.color = tg.themeParams.text_color || '#000000';

    // Получаем chat_id из URL
    const urlParams = new URLSearchParams(window.location.search);
    const chat_id = urlParams.get('chat_id');
    if (!chat_id) {
      alert('Ошибка: chat_id не найден');
    }

    // Пример данных (можете дополнить для Fortnite, Warcraft, Minecraft)
    const productsData = [
      {
        category: 'Robux',
        image: 'https://i.pinimg.com/564x/5a/03/19/5a03197c13860729206536d3fb4ca7dc.jpg',
        items: [
          { id: 1, amount: 100, price: 360 },
          { id: 2, amount: 200, price: 539 },
          { id: 3, amount: 400, price: 935 },
          { id: 4, amount: 800, price: 1290 },
          { id: 5, amount: 1200, price: 1990 },
        ]
      },
      {
        category: 'iTunes',
        image: 'https://i.pinimg.com/564x/53/60/b9/5360b97e71f3204c70275132893d0070.jpg',
        items: [
          { id: 12, amount: 500, price: 550 },
          { id: 13, amount: 1000, price: 1150 },
          { id: 14, amount: 1500, price: 1725 },
          { id: 15, amount: 2000, price: 2300 },
        ]
      },
      {
        category: 'Fortnite',
        image: 'https://cdn2.unrealengine.com/Fortnite%2Fblog%2Fpatch-v10-10-bring-on-the-bugs%2F10BR_ArtistPatchNotes_NewsHeader-1920x1080-32f2a3f46f43a50ec915c7d509c1f68b7c6c6b43.jpg',
        items: [
          // Пример номиналов для Фортнайта (можете дополнить)
          { id: 101, amount: 1000, price: 950 },
          { id: 102, amount: 2800, price: 1990 },
          { id: 103, amount: 5000, price: 3555 },
          { id: 104, amount: 13500, price: 7590 }
        ]
      },
      {
        category: 'Minecraft',
        image: 'https://upload.wikimedia.org/wikipedia/ru/2/20/Minecraft_logo.png',
        items: [
          // Пример номиналов для Майнкрафта
          { id: 201, amount: 1, price: 990 },  // Условно: 1 лицензия
          { id: 202, amount: 2, price: 1890 },
          { id: 203, amount: 5, price: 4390 }
        ]
      },
      {
        category: 'Warcraft',
        image: 'https://upload.wikimedia.org/wikipedia/ru/8/85/WarcraftIII_Reforged_Logo.png',
        items: [
          // Пример номиналов для Варкрафта
          { id: 301, amount: 1, price: 1290 },
          { id: 302, amount: 2, price: 2290 },
          { id: 303, amount: 3, price: 3390 }
        ]
      }
    ];

    let cart = [];

    // Селекторы
    const mainPage = document.getElementById('main-page');
    const productsPage = document.getElementById('products-page');
    const cartPage = document.getElementById('cart-page');

    const productsListEl = document.getElementById('products-list');
    const productsTitleEl = document.getElementById('products-title');

    const cartListEl = document.getElementById('cart-list');
    const checkoutButton = document.getElementById('checkout');
    const cartButton = document.getElementById('cart-button');
    const cartCountEl = document.getElementById('cart-count');

    // Кнопки "Назад"
    const backToMainBtn = document.getElementById('back-to-main');
    const backToMainFromCartBtn = document.getElementById('back-to-main-from-cart');

    // Показать/скрыть страницы
    function showPage(pageToShow) {
      // Прячем все страницы
      [mainPage, productsPage, cartPage].forEach(page => {
        page.classList.add('hidden');
      });
      // Показываем нужную страницу
      pageToShow.classList.remove('hidden');
    }

    // Обновление корзины (иконки/кнопки и экрана корзины)
    function updateCart() {
      // Обновляем количество в иконке корзины
      cartCountEl.textContent = cart.length;

      // Если находимся на странице корзины – перерисовать список
      cartListEl.innerHTML = '';
      if (cart.length === 0) {
        cartListEl.innerHTML = '<p>Ваша корзина пуста.</p>';
        checkoutButton.style.display = 'none';
      } else {
        cart.forEach((item, index) => {
          const cartItemDiv = document.createElement('div');
          cartItemDiv.className = 'cart-item';
          cartItemDiv.innerHTML = `
            <span>${item.item}</span>
            <div>
              <span>${item.price} руб.</span>
              <button class="remove-from-cart" data-index="${index}">Удалить</button>
            </div>
          `;
          cartListEl.appendChild(cartItemDiv);
        });
        checkoutButton.style.display = 'block';
      }

      // Обработчики кнопок "Удалить"
      document.querySelectorAll('.remove-from-cart').forEach(button => {
        button.addEventListener('click', () => {
          const index = button.getAttribute('data-index');
          cart.splice(index, 1);
          updateCart();
        });
      });
    }

    // Показать список товаров для выбранной категории
    function showProducts(category) {
      // Находим данные о категории
      const categoryData = productsData.find(item => item.category === category);
      if (!categoryData) return;

      // Заголовок
      productsTitleEl.textContent = categoryData.category;

      // Список товаров
      productsListEl.innerHTML = '';
      categoryData.items.forEach(product => {
        const productDiv = document.createElement('div');
        productDiv.className = 'product-item';

        productDiv.innerHTML = `
          <div class="product-info">
            <span class="product-name">${product.amount} ${categoryData.category}</span>
            <span class="product-price">${product.price} руб.</span>
          </div>
          <button class="add-to-cart">Добавить</button>
        `;

        productDiv.querySelector('.add-to-cart').addEventListener('click', () => {
          const id = product.id;
          const item = `${categoryData.category} ${product.amount}`;
          const price = product.price;
          cart.push({ id, item, price });
          tg.showAlert(`${item} добавлен в корзину.`);
          updateCart();
        });

        productsListEl.appendChild(productDiv);
      });
    }

    // Инициализация
    function init() {
      updateCart(); // Обновить корзину при загрузке
      showPage(mainPage); // Показать главную страницу

      // Скрыть/показать кнопку корзины (на главном экране нужна, на других – по желанию)
      cartButton.style.display = 'block';

      // Навешиваем события на карточки категорий
      document.querySelectorAll('.category-card').forEach(card => {
        card.addEventListener('click', () => {
          const category = card.getAttribute('data-category');
          showProducts(category);
          showPage(productsPage);
        });
      });

      // Кнопка "Назад" из списка товаров
      backToMainBtn.addEventListener('click', () => {
        showPage(mainPage);
      });

      // Кнопка "Корзина" (внизу экрана)
      cartButton.addEventListener('click', () => {
        showPage(cartPage);
      });

      // Кнопка "Назад" из корзины
      backToMainFromCartBtn.addEventListener('click', () => {
        showPage(mainPage);
      });

      // Оплатить
      checkoutButton.addEventListener('click', () => {
        if (cart.length === 0) {
          tg.showAlert('Корзина пуста!');
          return;
        }
        tg.sendData(JSON.stringify(cart));
        cart = [];
        updateCart();
        tg.close();
      });
    }

    init();
  </script>
</body>
</html>
