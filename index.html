<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Магазин цифровых товаров</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- Подключение Google Fonts (пример: Poppins) -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-color: var(--tg-theme-bg-color, #f2f2f2);
      --text-color: var(--tg-theme-text-color, #111);
      --secondary-bg-color: var(--tg-theme-secondary-bg-color, #fff);
      --button-color: var(--tg-theme-button-color, #007bff);
      --button-text-color: var(--tg-theme-button-text-color, #fff);
      --hint-color: var(--tg-theme-hint-color, rgba(17, 17, 17, 0.6));

      /* Glass / Apple-like */
      --glass-bg: rgba(255, 255, 255, 0.16);
      --glass-bg-strong: rgba(255, 255, 255, 0.22);
      --glass-border: rgba(255, 255, 255, 0.28);
      --glass-shadow: 0 10px 30px rgba(0, 0, 0, 0.10);
      --glass-shadow-soft: 0 6px 18px rgba(0, 0, 0, 0.08);
      --glass-blur: 18px;
      --radius-lg: 18px;
      --radius-md: 14px;
      --radius-sm: 12px;

      --transition-speed: 0.35s;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    html, body {
      height: 100%;
    }

    body {
      background:
        radial-gradient(1200px 800px at 15% 10%, rgba(0, 122, 255, 0.18), transparent 60%),
        radial-gradient(1000px 700px at 85% 25%, rgba(52, 199, 89, 0.14), transparent 60%),
        radial-gradient(900px 700px at 35% 95%, rgba(255, 45, 85, 0.12), transparent 60%),
        var(--bg-color);
      color: var(--text-color);
      overflow-x: hidden;
      overflow-y: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    h1, h2, h3 {
      font-weight: 500;
      letter-spacing: -0.02em;
      text-align: center;
      margin: 10px 0;
      line-height: 1.2;
    }

    h1 {
      font-size: clamp(18px, 5vw, 24px);
    }

    .hero-title {
      white-space: normal;
      overflow: visible;
      text-overflow: unset;
      padding: 0 6px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .tabs {
      position: sticky;
      top: 0;
      z-index: 10;
      display: flex;
      gap: 10px;
      padding: 10px 0 6px 0;
      margin-top: 6px;
      background: rgba(0, 0, 0, 0);
    }

    .tab-button {
      flex: 1;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.26);
      background: rgba(255, 255, 255, 0.12);
      color: var(--text-color);
      cursor: pointer;
      box-shadow: var(--glass-shadow-soft);
      backdrop-filter: blur(var(--glass-blur)) saturate(140%);
      -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(140%);
      transition: transform 0.15s ease, background var(--transition-speed) ease;
      font-weight: 600;
      letter-spacing: -0.01em;
    }

    .tab-button:hover {
      transform: translateY(-1px);
      background: rgba(255, 255, 255, 0.18);
    }

    .tab-button.active {
      background: rgba(0, 122, 255, 0.22);
      border-color: rgba(0, 122, 255, 0.30);
    }

    .category-card[data-hidden="true"] {
      display: none;
    }

    .products-container {
      align-items: stretch;
    }

    #products-list {
      max-width: 720px;
    }

    .page.hidden {
      pointer-events: none;
    }

    .category-card:active {
      transform: translateY(-2px) scale(0.99);
    }

    button {
      font-family: inherit;
    }

    /* Общий контейнер */
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      height: 100%;
    }

    /* Glass surfaces */
    .glass {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow-soft);
      backdrop-filter: blur(var(--glass-blur)) saturate(140%);
      -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(140%);
    }

    /* Subtle separators */
    .hr-soft {
      height: 1px;
      background: rgba(255, 255, 255, 0.18);
    }

    /* Страницы (экраны) */
    .page {
      width: 100%;
      min-height: 0;
      padding-bottom: calc(24px + env(safe-area-inset-bottom));
      opacity: 1;
      visibility: visible;
      transition: opacity var(--transition-speed) ease, visibility var(--transition-speed) ease;
      height: 100%;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }
    .page.hidden {
      opacity: 0;
      visibility: hidden;
      position: absolute;
      top: 0;
      left: 0;
    }

    /* Extra bottom space only when the floating cart button is visible */
    body.has-cart-button .page {
      padding-bottom: calc(96px + env(safe-area-inset-bottom));
    }

    /* Главный экран с категориями – всегда 2 колонки */
    .categories-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-top: 14px;
    }

    .category-card {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--glass-shadow);
      cursor: pointer;
      transition: transform var(--transition-speed) ease,
                  box-shadow var(--transition-speed) ease,
                  background var(--transition-speed) ease;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      backdrop-filter: blur(var(--glass-blur)) saturate(140%);
      -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(140%);
    }
    .category-card:hover {
      transform: translateY(-6px) scale(1.01);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.14);
      background: var(--glass-bg-strong);
    }
    .category-card img {
      width: 100%;
      height: auto;
      object-fit: cover;
      display: block;
      filter: saturate(1.05) contrast(1.02);
    }
    .category-card h2 {
      margin: 10px 10px 12px 10px;
      font-weight: 600;
      letter-spacing: -0.01em;
      font-size: 15px;
      line-height: 1.15;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* Экран товаров */
    .products-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      gap: 10px;
    }

    .back-button {
      align-self: flex-start;
      background: rgba(255, 255, 255, 0.18);
      border: 1px solid rgba(255, 255, 255, 0.28);
      color: var(--text-color);
      padding: 10px 14px;
      border-radius: 999px;
      cursor: pointer;
      text-decoration: none;
      margin-bottom: 10px;
      transition: transform 0.15s ease, background var(--transition-speed) ease;
      box-shadow: var(--glass-shadow-soft);
      backdrop-filter: blur(var(--glass-blur)) saturate(140%);
      -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(140%);
    }
    .back-button:hover {
      background: rgba(255, 255, 255, 0.26);
      transform: translateY(-1px);
    }

    /* Список товаров – тоже всегда 2 колонки */
    #products-list {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      width: 100%;
      max-width: 620px;
    }

    .product-item {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(var(--glass-blur)) saturate(140%);
      -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(140%);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: var(--radius-md);
      padding: 12px;
      box-shadow: var(--glass-shadow-soft);
      gap: 10px;
      min-height: 86px;
    }
    .product-info {
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-width: 0;
    }
    .product-name {
      font-size: 14px;
      margin: 0;
      font-weight: 600;
      letter-spacing: -0.01em;
      line-height: 1.15;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      word-break: break-word;
    }
    .product-price {
      font-size: 13px;
      color: var(--hint-color);
      line-height: 1.1;
    }
    .add-to-cart {
      background: rgba(0, 122, 255, 0.92);
      color: #fff;
      padding: 8px 12px;
      text-align: center;
      border-radius: 999px;
      cursor: pointer;
      text-decoration: none;
      transition: transform 0.15s ease, filter 0.2s ease, opacity 0.2s ease;
      font-size: 13px;
      white-space: nowrap;
      border: 1px solid rgba(255, 255, 255, 0.18);
    }
    .add-to-cart:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    /* Кнопка "Корзина" на главном экране */
    .cart-button {
      position: fixed;
      bottom: 18px;
      right: 18px;
      background: rgba(52, 199, 89, 0.90);
      color: #fff;
      padding: 12px 18px;
      border-radius: 999px;
      cursor: pointer;
      text-decoration: none;
      transition: transform 0.15s ease, filter 0.2s ease;
      font-size: 15px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.18);
      z-index: 999;
      border: 1px solid rgba(255, 255, 255, 0.18);
    }
    .cart-button:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    /* Экран корзины */
    .cart-page .products-container {
      align-items: flex-start;
    }
    #cart-list {
      width: 100%;
      max-width: 500px;
    }
    .cart-item {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(var(--glass-blur)) saturate(140%);
      -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(140%);
      padding: 12px;
      margin: 8px 0;
      border-radius: var(--radius-md);
      box-shadow: var(--glass-shadow-soft);
    }
    .remove-from-cart {
      background: rgba(255, 59, 48, 0.92);
      color: #fff;
      padding: 8px 12px;
      border-radius: 999px;
      cursor: pointer;
      text-decoration: none;
      transition: transform 0.15s ease, filter 0.2s ease;
      font-size: 13px;
      margin-left: 10px;
      white-space: nowrap;
      border: 1px solid rgba(255, 255, 255, 0.18);
    }
    .remove-from-cart:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    #checkout {
      background: rgba(52, 199, 89, 0.92);
      color: #fff;
      padding: 14px 20px;
      text-align: center;
      border-radius: 999px;
      cursor: pointer;
      text-decoration: none;
      transition: transform 0.15s ease, filter 0.2s ease;
      margin: 18px auto 0 auto;
      display: none;
      font-size: 16px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.14);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }
    #checkout:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    /* Анимация плавного появления / скрытия страниц (если нужно) */
    .fade-enter {
      opacity: 0;
      transform: translateY(10px);
    }
    .fade-enter.fade-enter-active {
      opacity: 1;
      transform: translateY(0);
      transition: opacity var(--transition-speed), transform var(--transition-speed);
    }
    .fade-exit {
      opacity: 1;
      transform: translateY(0);
    }
    .fade-exit.fade-exit-active {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity var(--transition-speed), transform var(--transition-speed);
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Главный экран (категории) -->
    <div id="main-page" class="page">
      <h1 class="hero-title">Game Over Shop</h1>
      <div class="tabs" role="tablist" aria-label="Каталоги">
        <button class="tab-button active" id="tab-topup" type="button" data-group="topup" aria-selected="true">Пополнение</button>
        <button class="tab-button" id="tab-subs-ru" type="button" data-group="subs_ru" aria-selected="false">Подписки RU</button>
        <button class="tab-button" id="tab-games" type="button" data-group="games" aria-selected="false">Игры</button>
      </div>

      <div class="categories-grid" id="categories-grid">
        <!-- Пополнение -->
        <div class="category-card" data-group="topup" data-category="Robux">
          <img src="https://i.pinimg.com/736x/21/c7/b2/21c7b257c91559b31bf27f7dfcc8f42a.jpg" alt="Robux">
          <h2>Robux</h2>
        </div>

        <div class="category-card" data-group="topup" data-category="Itunes">
          <img src="https://i.pinimg.com/736x/8a/da/29/8ada29e9acd126f1bc683806c42aa531.jpg" alt="Itunes">
          <h2>Itunes</h2>
        </div>

        <div class="category-card" data-group="topup" data-category="Steam USA">
          <img src="https://i.pinimg.com/736x/54/a8/9a/54a89aa169f409ed4573d3454ce46879.jpg" alt="Steam USA">
          <h2>Steam USA</h2>
        </div>

        <div class="category-card" data-group="topup" data-category="Steam EU">
          <img src="https://i.pinimg.com/736x/91/a5/79/91a5797b81a1e4bfbb96544032ea6802.jpg" alt="Steam EU">
          <h2>Steam EU</h2>
        </div>

        <div class="category-card" data-group="topup" data-category="PSN Турция">
          <img src="https://i.pinimg.com/1200x/97/e8/52/97e8525606fff33170d19073a738ecef.jpg" alt="PSN Турция">
          <h2>PSN Турция</h2>
        </div>

        <div class="category-card" data-group="topup" data-category="Warcraft Time Card">
          <img src="https://i.pinimg.com/736x/11/e3/38/11e338a89b0c32dc6eda80ef95859552.jpg" alt="Warcraft Time Card">
          <h2>Warcraft Time Card</h2>
        </div>

        <div class="category-card" data-group="topup" data-category="V-bucks">
          <img src="https://i.pinimg.com/736x/c7/ae/66/c7ae66b1ac804a763ae892d16fa61d5d.jpg" alt="V-bucks">
          <h2>V-bucks</h2>
        </div>

        <div class="category-card" data-group="topup" data-category="Eshop USA">
          <img src="https://i.pinimg.com/736x/26/67/4d/26674df1087c2d2d0681a7b9cd8b1749.jpg" alt="Eshop USA">
          <h2>Eshop USA</h2>
        </div>

        <div class="category-card" data-group="topup" data-category="MineCoin">
          <img src="https://i.pinimg.com/736x/b6/7f/23/b67f239a74bd73a7d01ce4b590a803a2.jpg" alt="MineCoin">
          <h2>MineCoin</h2>
        </div>

        <!-- Подписки RU -->
        <div class="category-card" data-group="subs_ru" data-category="Premier">
          <img src="https://i.pinimg.com/1200x/ef/6f/ca/ef6fca261e05ab8bd3d2861e1965cd09.jpg" alt="Premier">
          <h2>Premier</h2>
        </div>

        <div class="category-card" data-group="subs_ru" data-category="OKKO">
          <img src="https://i.pinimg.com/1200x/0f/0e/a8/0f0ea81cb403c456ef94b3288c402e0b.jpg" alt="OKKO">
          <h2>OKKO</h2>
        </div>

        <div class="category-card" data-group="subs_ru" data-category="START">
          <img src="https://i.pinimg.com/736x/45/21/af/4521af9a7cb4ffde28c4083d543654ed.jpg" alt="START">
          <h2>START</h2>
        </div>

        <div class="category-card" data-group="subs_ru" data-category="ИВИ">
          <img src="https://i.pinimg.com/736x/9f/d7/5c/9fd75c1011662a58612d90ef5ded2bc6.jpg" alt="ИВИ">
          <h2>ИВИ</h2>
        </div>

        <div class="category-card" data-group="subs_ru" data-category="ЛИТРЕС">
          <img src="https://i.pinimg.com/736x/e2/65/dc/e265dceeefa261f9db9fd20cf0f5fb86.jpg" alt="ЛИТРЕС">
          <h2>ЛИТРЕС</h2>
        </div>

        <!-- Игры -->
        <div class="category-card" data-group="games" data-category="GTA V Premium">
          <img src="https://i.pinimg.com/736x/ed/ab/8d/edab8d866756d7116f42054410c7767f.jpg" alt="GTA V Premium">
          <h2>GTA V Premium</h2>
        </div>

        <div class="category-card" data-group="games" data-category="Minecraft Java & Bedrock">
          <img src="https://i.pinimg.com/736x/2b/fc/22/2bfc224db38d7aec5242ee51a09a6770.jpg" alt="Minecraft Java & Bedrock">
          <h2>Minecraft Java & Bedrock</h2>
        </div>

        <div class="category-card" data-group="games" data-category="Sims 4 Дополнения">
          <img src="https://i.pinimg.com/736x/3b/07/40/3b0740a6bd3b307d87d9f49e914d58f9.jpg" alt="Sims 4 Дополнения">
          <h2>Sims 4 Дополнения</h2>
        </div>
      </div>
    </div>

    <!-- Экран с товарами выбранной категории -->
    <div id="products-page" class="page hidden">
      <div class="products-container">
        <button class="back-button" id="back-to-main">Назад</button>
        <h2 id="products-title">Категория</h2>
        <div id="products-list"></div>
      </div>
    </div>

    <!-- Экран корзины -->
    <div id="cart-page" class="page hidden cart-page">
      <div class="products-container">
        <button class="back-button" id="back-to-main-from-cart">Назад</button>
        <h2>Корзина</h2>
        <div id="cart-list"></div>
        <div id="checkout">Оплатить</div>
      </div>
    </div>
  </div>

  <!-- Кнопка для отображения корзины (только на главном экране) -->
  <div class="cart-button" id="cart-button" style="display: none;">
    Корзина (<span id="cart-count">0</span>)
  </div>

  <!-- Подключение Telegram WebApp JS -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <script>
    // Инициализация Telegram Web Apps
    const tg = window.Telegram.WebApp;
    tg.expand();

    // Устанавливаем цвета темы приложения
    document.documentElement.style.setProperty('--bg-color', tg.themeParams.bg_color || '#ffffff');
    document.documentElement.style.setProperty('--text-color', tg.themeParams.text_color || '#000000');

    // Получаем chat_id из URL
    const urlParams = new URLSearchParams(window.location.search);
    const chat_id = urlParams.get('chat_id');
    if (!chat_id) {
      alert('Ошибка: chat_id не найден');
    }

    // Данные товаров
    const productsData = [
      {
        category: 'Robux',
        image: 'https://i.pinimg.com/736x/21/c7/b2/21c7b257c91559b31bf27f7dfcc8f42a.jpg',
        items: [
          { id: 1, amount: 100, price: 360 },
          { id: 2, amount: 200, price: 539 },
          { id: 3, amount: 400, price: 935 },
          { id: 4, amount: 800, price: 1290 },
          { id: 5, amount: 1200, price: 1990 },
          { id: 6, amount: 1700, price: 2390 },
          { id: 7, amount: 2000, price: 2890 },
          { id: 8, amount: 2200, price: 3090 },
          { id: 9, amount: 2700, price: 3380 },
          { id: 10, amount: 4500, price: 5590 },
          { id: 11, amount: 10000, price: 10350 }
        ]
      },
      {
        category: 'Itunes',
        image: 'https://i.pinimg.com/736x/8a/da/29/8ada29e9acd126f1bc683806c42aa531.jpg',
        items: [
          { id: 12, amount: 500, price: 550 },
          { id: 13, amount: 1000, price: 1150 },
          { id: 14, amount: 1500, price: 1725 },
          { id: 15, amount: 2000, price: 2300 },
          { id: 16, amount: 2500, price: 2875 },
          { id: 17, amount: 3000, price: 3450 },
          { id: 18, amount: 3500, price: 4025 },
          { id: 19, amount: 4000, price: 4600 },
          { id: 20, amount: 4500, price: 5175 },
          { id: 21, amount: 5000, price: 5750 },
          { id: 22, amount: 5500, price: 6325 },
          { id: 23, amount: 6000, price: 6900 },
          { id: 24, amount: 6500, price: 7475 },
          { id: 25, amount: 7000, price: 8050 },
          { id: 26, amount: 7500, price: 8625 },
          { id: 27, amount: 8000, price: 9200 },
          { id: 28, amount: 8500, price: 9775 },
          { id: 29, amount: 9000, price: 10350 }
        ]
      },
      {
        category: 'Steam USA',
        image: 'https://i.pinimg.com/736x/54/a8/9a/54a89aa169f409ed4573d3454ce46879.jpg',
        items: [
          { id: 200, amount: '1 позиция', price: 100 }
        ]
      },
      {
        category: 'Steam EU',
        image: 'https://i.pinimg.com/736x/91/a5/79/91a5797b81a1e4bfbb96544032ea6802.jpg',
        items: [
          { id: 201, amount: '1 позиция', price: 100 }
        ]
      },
      {
        category: 'PSN Турция',
        image: 'https://i.pinimg.com/1200x/97/e8/52/97e8525606fff33170d19073a738ecef.jpg',
        items: [
          { id: 47, amount: '250 TL', price: 1000 },
          { id: 48, amount: '500 TL', price: 1000 },
          { id: 49, amount: '750 TL', price: 1000 },
          { id: 50, amount: '1000 TL', price: 1000 },
          { id: 51, amount: '1500 TL', price: 1000 },
          { id: 52, amount: '2000 TL', price: 1000 },
          { id: 53, amount: '2500 TL', price: 1000 },
          { id: 54, amount: '3000 TL', price: 1000 },
          { id: 55, amount: '3500 TL', price: 1000 },
          { id: 56, amount: '4000 TL', price: 1000 },
          { id: 57, amount: '4500 TL', price: 1000 },
          { id: 58, amount: '5000 TL', price: 1000 }
        ]
      },
      {
        category: 'Warcraft Time Card',
        image: 'https://i.pinimg.com/736x/11/e3/38/11e338a89b0c32dc6eda80ef95859552.jpg',
        items: [
          { id: 37, amount: 'Time карта 60 дней', price: 2399 }
        ]
      },
      {
        category: 'V-bucks',
        image: 'https://i.pinimg.com/736x/c7/ae/66/c7ae66b1ac804a763ae892d16fa61d5d.jpg',
        items: [
          { id: 30, amount: 1000, price: 1899 },
          { id: 31, amount: 2800, price: 3349 },
          { id: 32, amount: 5000, price: 5299 },
          { id: 33, amount: 13500, price: 12799 }
        ]
      },
      {
        category: 'Eshop USA',
        image: 'https://i.pinimg.com/736x/26/67/4d/26674df1087c2d2d0681a7b9cd8b1749.jpg',
        items: [
          { id: 59, amount: '5$', price: 100 },
          { id: 60, amount: '10$', price: 100 },
          { id: 61, amount: '20$', price: 100 },
          { id: 62, amount: '25$', price: 100 },
          { id: 63, amount: '35$', price: 100 },
          { id: 64, amount: '50$', price: 100 }
        ]
      },
      {
        category: 'MineCoin',
        image: 'https://i.pinimg.com/736x/b6/7f/23/b67f239a74bd73a7d01ce4b590a803a2.jpg',
        items: [
          { id: 34, amount: 330, price: 189 },
          { id: 35, amount: 1720, price: 1149 },
          { id: 36, amount: 3500, price: 2499 }
        ]
      },
      {
        category: 'Premier',
        image: 'https://i.pinimg.com/1200x/ef/6f/ca/ef6fca261e05ab8bd3d2861e1965cd09.jpg',
        items: [
          { id: 38, amount: '1 мес.', price: 100 },
          { id: 39, amount: '3 мес.', price: 200 },
          { id: 40, amount: '6 мес.', price: 300 },
          { id: 41, amount: '12 мес.', price: 700 }
        ]
      },
      {
        category: 'OKKO',
        image: 'https://i.pinimg.com/1200x/0f/0e/a8/0f0ea81cb403c456ef94b3288c402e0b.jpg',
        items: [
          { id: 42, amount: '1 мес.', price: 100 },
          { id: 43, amount: '1+1 мес.', price: 300 },
          { id: 44, amount: '3 мес.', price: 500 },
          { id: 45, amount: '6 мес.', price: 700 },
          { id: 46, amount: '12 мес.', price: 1200 }
        ]
      },
      {
        category: 'START',
        image: 'https://i.pinimg.com/736x/45/21/af/4521af9a7cb4ffde28c4083d543654ed.jpg',
        items: [
          { id: 65, amount: '1 мес', price: 100 },
          { id: 66, amount: '3 мес', price: 100 },
          { id: 67, amount: '6 мес', price: 100 },
          { id: 68, amount: '12 мес', price: 100 }
        ]
      },
      {
        category: 'ИВИ',
        image: 'https://i.pinimg.com/736x/9f/d7/5c/9fd75c1011662a58612d90ef5ded2bc6.jpg',
        items: [
          { id: 73, amount: '1 мес', price: 100 },
          { id: 74, amount: '3 мес', price: 100 },
          { id: 75, amount: '6 мес', price: 100 },
          { id: 76, amount: '12 мес', price: 100 },
          { id: 77, amount: '24 мес', price: 100 },
          { id: 78, amount: '36 мес', price: 100 }
        ]
      },
      {
        category: 'ЛИТРЕС',
        image: 'https://i.pinimg.com/736x/e2/65/dc/e265dceeefa261f9db9fd20cf0f5fb86.jpg',
        items: [
          { id: 69, amount: '1 мес', price: 100 },
          { id: 70, amount: '3 мес', price: 100 },
          { id: 71, amount: '6 мес', price: 100 },
          { id: 72, amount: '12 мес', price: 100 }
        ]
      },
      {
        category: 'Sims 4 Дополнения',
        image: 'https://i.pinimg.com/736x/3b/07/40/3b0740a6bd3b307d87d9f49e914d58f9.jpg',
        items: [
          { id: 79, amount: 'Growing Together | Жизненный путь', price: 100 },
          { id: 80, amount: 'For Rent | Сдается', price: 100 },
          { id: 81, amount: 'Eco Lifestyle | Экологичная жизнь', price: 100 },
          { id: 82, amount: 'Dine Out | В Ресторане', price: 100 },
          { id: 83, amount: 'Lovestruck | Стрелы купидона', price: 100 },
          { id: 84, amount: 'Cottage Living | Загородная жизнь', price: 100 },
          { id: 85, amount: 'Snowy Escape | Снежные просторы', price: 100 },
          { id: 86, amount: 'Seasons | Времена года', price: 100 },
          { id: 87, amount: 'Get Together | Веселимся вместе', price: 100 },
          { id: 88, amount: 'Outdoor Retreat | В поход', price: 100 },
          { id: 89, amount: 'Get to Work | На работу', price: 100 },
          { id: 90, amount: 'High School | Старшая школа', price: 100 },
          { id: 91, amount: 'Island Living | Жизнь на острове', price: 100 },
          { id: 92, amount: 'City Living | Жизнь в городе', price: 100 },
          { id: 93, amount: 'Get Famous | Путь к славе', price: 100 },
          { id: 94, amount: 'Cats & Dogs | Кошки и Собаки', price: 100 },
          { id: 95, amount: 'Journey to Batuu | Путешествие на Бату', price: 100 },
          { id: 96, amount: 'StrangerVille | Страйнджервиль', price: 100 },
          { id: 97, amount: 'Realm of Magic | Мир магии', price: 100 },
          { id: 98, amount: 'Jungle Adventure | Приключения в джунглях', price: 100 },
          { id: 99, amount: 'Parenthood | Родители', price: 100 },
          { id: 100, amount: 'Discover University | В университете', price: 100 },
          { id: 101, amount: 'Horse Ranch | Конное ранчо', price: 100 },
          { id: 102, amount: 'Enchanted By Nature | Волшебство природы', price: 100 }
        ]
      },
      {
        category: 'GTA V Premium',
        image: 'https://i.pinimg.com/736x/ed/ab/8d/edab8d866756d7116f42054410c7767f.jpg',
        items: [
          { id: 202, amount: '1 позиция', price: 100 }
        ]
      },
      {
        category: 'Minecraft Java & Bedrock',
        image: 'https://i.pinimg.com/736x/2b/fc/22/2bfc224db38d7aec5242ee51a09a6770.jpg',
        items: [
          { id: 203, amount: '1 позиция', price: 100 }
        ]
      }
    ];

    let cart = [];

    // Селекторы
    const mainPage = document.getElementById('main-page');
    const productsPage = document.getElementById('products-page');
    const cartPage = document.getElementById('cart-page');

    const productsListEl = document.getElementById('products-list');
    const productsTitleEl = document.getElementById('products-title');

    const cartListEl = document.getElementById('cart-list');
    const checkoutButton = document.getElementById('checkout');
    const cartButton = document.getElementById('cart-button');
    const cartCountEl = document.getElementById('cart-count');

    // Кнопки "Назад"
    const backToMainBtn = document.getElementById('back-to-main');
    const backToMainFromCartBtn = document.getElementById('back-to-main-from-cart');

    // Показать/скрыть страницы + прокрутка вверх
    function showPage(pageToShow) {
      [mainPage, productsPage, cartPage].forEach(page => {
        page.classList.add('hidden');
      });
      pageToShow.classList.remove('hidden');
      // Показываем плавающую кнопку корзины только там, где она нужна
      const showCartFab = (pageToShow === mainPage || pageToShow === productsPage);
      cartButton.style.display = showCartFab ? 'block' : 'none';
      document.body.classList.toggle('has-cart-button', showCartFab);
      // Прокрутка к верху, чтобы всегда видеть начало списка
      window.scrollTo(0, 0);
    }

    // Обновление корзины (иконки/кнопки и экрана корзины)
    function updateCart() {
      // Обновляем количество в иконке корзины
      cartCountEl.textContent = cart.length;

      // Перерисовываем список корзины
      cartListEl.innerHTML = '';
      if (cart.length === 0) {
        cartListEl.innerHTML = '<p>Ваша корзина пуста.</p>';
        checkoutButton.style.display = 'none';
      } else {
        cart.forEach((item, index) => {
          const cartItemDiv = document.createElement('div');
          cartItemDiv.className = 'cart-item';
          cartItemDiv.innerHTML = `
            <span>${item.item}</span>
            <div>
              <span>${item.price} руб.</span>
              <button class="remove-from-cart" data-index="${index}">Удалить</button>
            </div>
          `;
          cartListEl.appendChild(cartItemDiv);
        });
        checkoutButton.style.display = 'block';
      }

      // Обработчики кнопок "Удалить"
      document.querySelectorAll('.remove-from-cart').forEach(button => {
        button.addEventListener('click', () => {
          const index = button.getAttribute('data-index');
          cart.splice(index, 1);
          updateCart();
        });
      });
    }

    // Показать список товаров для выбранной категории
    function showProducts(category) {
      const categoryData = productsData.find(item => item.category === category);
      if (!categoryData) return;

      productsTitleEl.textContent = categoryData.category;

      // Заполняем список товаров
      productsListEl.innerHTML = '';
      categoryData.items.forEach(product => {
        const productDiv = document.createElement('div');
        productDiv.className = 'product-item';

        productDiv.innerHTML = `
          <div class="product-info">
            <span class="product-name">${product.amount}</span>
            <span class="product-price">${product.price} руб.</span>
          </div>
          <button class="add-to-cart">Добавить</button>
        `;

        // Добавляем в корзину
        productDiv.querySelector('.add-to-cart').addEventListener('click', () => {
          const id = product.id;
          const item = `${categoryData.category} ${product.amount}`;
          const price = product.price;
          cart.push({ id, item, price });
          tg.showAlert(`${item} добавлен в корзину.`);
          updateCart();
        });

        productsListEl.appendChild(productDiv);
      });
    }

    // Инициализация
    function init() {
      updateCart();         // Обновить корзину при загрузке
      showPage(mainPage);   // Показать главную страницу

      // Кнопку корзины покажем через showPage()
      document.body.classList.add('has-cart-button');

      // Tabs: быстрый доступ к Пополнению/Подпискам RU/Играм
      const tabTopup = document.getElementById('tab-topup');
      const tabSubsRu = document.getElementById('tab-subs-ru');
      const tabGames = document.getElementById('tab-games');

      function setActiveTab(group) {
        const isTopup = group === 'topup';
        const isSubsRu = group === 'subs_ru';
        const isGames = group === 'games';

        tabTopup.classList.toggle('active', isTopup);
        tabSubsRu.classList.toggle('active', isSubsRu);
        tabGames.classList.toggle('active', isGames);

        tabTopup.setAttribute('aria-selected', isTopup ? 'true' : 'false');
        tabSubsRu.setAttribute('aria-selected', isSubsRu ? 'true' : 'false');
        tabGames.setAttribute('aria-selected', isGames ? 'true' : 'false');

        document.querySelectorAll('.category-card').forEach(card => {
          const cardGroup = card.getAttribute('data-group');
          card.setAttribute('data-hidden', cardGroup === group ? 'false' : 'true');
        });

        // наверх списка
        window.scrollTo(0, 0);
      }

      tabTopup.addEventListener('click', () => setActiveTab('topup'));
      tabSubsRu.addEventListener('click', () => setActiveTab('subs_ru'));
      tabGames.addEventListener('click', () => setActiveTab('games'));

      // По умолчанию показываем пополнение
      setActiveTab('topup');

      // Обработчики клика на карточки категорий
      document.querySelectorAll('.category-card').forEach(card => {
        card.addEventListener('click', () => {
          const category = card.getAttribute('data-category');
          showProducts(category);
          showPage(productsPage);
        });
      });

      // Кнопка "Назад" из списка товаров
      backToMainBtn.addEventListener('click', () => {
        showPage(mainPage);
      });

      // Кнопка "Корзина"
      cartButton.addEventListener('click', () => {
        showPage(cartPage);
      });

      // Кнопка "Назад" из корзины
      backToMainFromCartBtn.addEventListener('click', () => {
        showPage(mainPage);
      });

      // Оплатить
      checkoutButton.addEventListener('click', () => {
        if (cart.length === 0) {
          tg.showAlert('Корзина пуста!');
          return;
        }
        tg.sendData(JSON.stringify(cart));
        cart = [];
        updateCart();
        tg.close();
      });
    }

    init();
  </script>
</body>
</html>
